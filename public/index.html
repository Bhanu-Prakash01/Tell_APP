<!DOCTYPE html>
<html>
<head>
	<title>Login</title>
	<link rel="stylesheet" href="/assets/frappe.css">
	<style>
		/* Page */
		html, body { height: 100%; }
		body { display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #eef2ff 0%, #f5f7ff 40%, #ffffff 100%); }

		/* Card */
		.auth-card { width: 100%; max-width: 400px; background: var(--fr-surface); border: 1px solid var(--fr-border); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); padding: 24px; }
		.brand { display: flex; align-items: center; gap: 12px; justify-content: center; margin-bottom: 8px; }
		.brand-logo { width: 40px; height: 40px; border-radius: 10px; background: var(--fr-primary); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; }
		.brand h2 { margin: 0; font-size: 20px; }
		.subtitle { text-align: center; color: var(--fr-muted); margin: 0 0 16px 0; font-size: 14px; }

		/* Form */
		.form-group { margin-bottom: 12px; }
		.label { display: block; font-size: 12px; color: var(--fr-muted); margin-bottom: 6px; }
		.input-wrap { position: relative; }
		.input { width: 100%; padding: 12px 40px 12px 12px; border: 1px solid var(--fr-border); border-radius: 10px; background: #fff; }
		.input:focus { outline: none; border-color: var(--fr-primary); box-shadow: 0 0 0 3px rgba(94,100,255,.15); }
		.toggle-pass { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); border: 0; background: transparent; color: var(--fr-muted); cursor: pointer; padding: 6px; border-radius: 8px; }
		.toggle-pass:hover { background: var(--fr-bg); color: var(--fr-text); }

		/* Actions */
		.actions { display: flex; align-items: center; justify-content: space-between; margin: 8px 0 14px 0; }
		.remember { display: inline-flex; align-items: center; gap: 8px; font-size: 13px; color: var(--fr-text); }
		.link { color: var(--fr-primary); text-decoration: none; font-size: 13px; }
		.link:hover { text-decoration: underline; }

		.btn { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid transparent; background: var(--fr-primary); color: #fff; cursor: pointer; font-weight: 600; }
		.btn:hover { background: var(--fr-primary-600); }

		/* Error */
		.error { display: none; margin-top: 12px; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(225,29,72,.25); background: rgba(225,29,72,.06); color: var(--fr-red); text-align: center; }

		/* Footer */
		.meta { text-align: center; margin-top: 16px; font-size: 12px; color: var(--fr-muted); }
	</style>
</head>
<body>

<div class="auth-card">
	<div class="brand">
		<div class="brand-logo">TC</div>
		<h2>Tele Calling</h2>
	</div>
	<p class="subtitle">Welcome back! Sign in to continue.</p>
	<div class="form-group">
		<label class="label" for="email">Email</label>
		<div class="input-wrap">
			<input class="input" type="email" id="email" placeholder="name@example.com" required>
		</div>
	</div>
	<div class="form-group">
		<label class="label" for="password">Password</label>
		<div class="input-wrap">
			<input class="input" type="password" id="password" placeholder="••••••••" required>
			<button class="toggle-pass" type="button" aria-label="Show password" onclick="togglePassword()">Show</button>
		</div>
	</div>
	<div class="actions">
		<label class="remember"><input type="checkbox" id="remember"> Remember me</label>
		<a class="link" href="#" onclick="forgotPassword(event)">Forgot password?</a>
	</div>
	<button class="btn" onclick="login()">Sign in</button>
	<div class="error" id="error"></div>
	<p class="meta">Having trouble? Contact your administrator.</p>
</div>

<script>
	function togglePassword(){
		const input = document.getElementById('password');
		const btn = event.currentTarget;
		if(input.type === 'password'){
			input.type = 'text';
			btn.textContent = 'Hide';
			btn.setAttribute('aria-label','Hide password');
		}else{
			input.type = 'password';
			btn.textContent = 'Show';
			btn.setAttribute('aria-label','Show password');
		}
	}

	function forgotPassword(e){
		e && e.preventDefault();
		const errorDiv = document.getElementById('error');
		errorDiv.style.display = 'block';
		errorDiv.textContent = 'Please contact your admin to reset your password.';
		setTimeout(()=>{ errorDiv.style.display='none'; }, 4000);
	}

	document.addEventListener('keydown', function(e){
		if(e.key === 'Enter'){
			login();
		}
	});

	async function login() {
		const email = document.getElementById('email').value.trim();
		const password = document.getElementById('password').value;
		const remember = document.getElementById('remember').checked;
		const errorDiv = document.getElementById('error');

		errorDiv.textContent = '';
		errorDiv.style.display = 'none';

		if(!email || !password){
			errorDiv.textContent = 'Please enter email and password.';
			errorDiv.style.display = 'block';
			return;
		}

		try {
			const res = await fetch('/api/auth/login', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ email, password })
			});

			const data = await res.json();

			if (!res.ok) {
				errorDiv.textContent = data.error || 'Login failed';
				errorDiv.style.display = 'block';
				return;
			}

			localStorage.setItem('token', data.token);
			localStorage.setItem('role', data.role);
			if (remember) { localStorage.setItem('remember', '1'); } else { localStorage.removeItem('remember'); }

			// Redirect based on role
			if (data.role === 'admin') {
				window.location.href = '/admin/overview.html';
			} else if (data.role === 'manager') {
				window.location.href = '/manager.html';
			} else {
				window.location.href = '/employee.html';
			}
		} catch (err) {
			errorDiv.textContent = 'Server error';
			errorDiv.style.display = 'block';
		}
	}
</script>

</body>
</html>
