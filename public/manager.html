<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Panel - Tele Calling System</title>
    <link rel="stylesheet" href="assets/frappe.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Enhanced Manager Panel Styles */
        :root {
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 70px;
            --header-height: 70px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--fr-bg);
            color: var(--fr-text);
            overflow-x: hidden;
        }

        /* Layout Structure */
        .manager-layout {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #1a1d29 0%, #0f1419 100%);
            color: #e2e8f0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            z-index: 1000;
            transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        /* Sidebar Header */
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar.collapsed .sidebar-header {
            padding: 20px 10px;
            justify-content: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
        }

        .logo i {
            font-size: 24px;
            color: var(--fr-primary);
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .sidebar-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .sidebar.collapsed .sidebar-toggle {
            display: none;
        }

        /* Navigation */
        .nav-section {
            padding: 20px 0;
        }

        .nav-title {
            padding: 0 20px 12px;
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sidebar.collapsed .nav-title {
            display: none;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            position: relative;
        }

        .sidebar.collapsed .nav-item {
            padding: 12px 0;
            justify-content: center;
        }

        .nav-item:hover {
            background: rgba(94, 100, 255, 0.1);
            color: #ffffff;
            border-left-color: var(--fr-primary);
        }

        .nav-item.active {
            background: rgba(94, 100, 255, 0.15);
            color: #ffffff;
            border-left-color: var(--fr-primary);
        }

        .nav-item i {
            width: 20px;
            font-size: 16px;
            margin-right: 12px;
            text-align: center;
        }

        .sidebar.collapsed .nav-item i {
            margin-right: 0;
        }

        .nav-text {
            font-weight: 500;
            font-size: 14px;
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .nav-badge {
            background: var(--fr-primary);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            font-weight: 600;
        }

        .sidebar.collapsed .nav-badge {
            display: none;
        }

        /* Tooltip for collapsed sidebar */
        .nav-tooltip {
            position: absolute;
            left: 70px;
            background: #1e293b;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1001;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar.collapsed .nav-item:hover .nav-tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100vh;
            background: var(--fr-bg);
        }

        .sidebar.collapsed + .main-content {
            margin-left: var(--sidebar-collapsed-width);
        }

        /* Header */
        .main-header {
            background: var(--fr-surface);
            border-bottom: 1px solid var(--fr-border);
            padding: 0 30px;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            color: var(--fr-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
        }

        .mobile-menu-toggle:hover {
            background: var(--fr-border);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--fr-text);
            margin: 0;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--fr-muted);
        }

        .breadcrumb-separator {
            color: var(--fr-border);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background: var(--fr-bg);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--fr-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--fr-text);
        }

        .user-role {
            font-size: 12px;
            color: var(--fr-muted);
        }

        /* Content Area */
        .content-area {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Section Management */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--fr-surface);
            border: 1px solid var(--fr-border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--fr-primary), var(--fr-primary-600));
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--fr-primary);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.primary { background: var(--fr-primary); }
        .stat-icon.success { background: var(--fr-green); }
        .stat-icon.warning { background: var(--fr-orange); }
        .stat-icon.danger { background: var(--fr-red); }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--fr-text);
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--fr-muted);
            font-weight: 500;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            margin-top: 8px;
        }

        .stat-trend.positive { color: var(--fr-green); }
        .stat-trend.negative { color: var(--fr-red); }

        /* Cards */
        .card {
            background: var(--fr-surface);
            border: 1px solid var(--fr-border);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--fr-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--fr-text);
            margin: 0;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-body {
            padding: 24px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid transparent;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--fr-primary);
            color: white;
            border-color: var(--fr-primary);
        }

        .btn-primary:hover {
            background: var(--fr-primary-600);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: transparent;
            color: var(--fr-text);
            border-color: var(--fr-border);
        }

        .btn-secondary:hover {
            background: var(--fr-bg);
            border-color: var(--fr-primary);
        }

        .btn-success {
            background: var(--fr-green);
            color: white;
            border-color: var(--fr-green);
        }

        .btn-success:hover {
            background: #22c55e;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--fr-border);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--fr-surface);
        }

        .table th,
        .table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--fr-border);
        }

        .table th {
            background: var(--fr-bg);
            font-weight: 600;
            font-size: 14px;
            color: var(--fr-text);
        }

        .table tbody tr:hover {
            background: var(--fr-bg);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .badge-new { background: #dbeafe; color: #1e40af; }
        .badge-interested { background: #dcfce7; color: #166534; }
        .badge-hot { background: #fecaca; color: #991b1b; }
        .badge-follow-up { background: #fef3c7; color: #92400e; }
        .badge-won { background: #bbf7d0; color: #15803d; }
        .badge-lost { background: #f3e8ff; color: #7c3aed; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--fr-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin: 0 0 8px 0;
            color: var(--fr-text);
        }

        .empty-state p {
            margin: 0;
            font-size: 14px;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--fr-muted);
        }

        .loading i {
            font-size: 24px;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--fr-surface);
            border: 1px solid var(--fr-border);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            max-width: 400px;
            animation: slideIn 0.3s ease;
        }

        .notification-success { border-left: 4px solid var(--fr-green); }
        .notification-error { border-left: 4px solid var(--fr-red); }
        .notification-info { border-left: 4px solid var(--fr-primary); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .content-area {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
            }

            .main-header {
                padding: 0 20px;
            }

            .user-info {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .header-actions {
                flex-direction: column;
                gap: 8px;
            }

            .table-container {
                font-size: 14px;
            }

            .table th,
            .table td {
                padding: 8px 12px;
            }
        }

        /* Sidebar Overlay for Mobile */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .quick-action {
            background: var(--fr-surface);
            border: 1px solid var(--fr-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: var(--fr-text);
        }

        .quick-action:hover {
            border-color: var(--fr-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .quick-action i {
            font-size: 24px;
            color: var(--fr-primary);
            margin-bottom: 12px;
        }

        .quick-action-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .quick-action-desc {
            font-size: 12px;
            color: var(--fr-muted);
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="manager-layout">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-phone-alt"></i>
                    <span class="logo-text">TeleCRM</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-title">Main</div>
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span class="nav-text">Dashboard</span>
                    <span class="nav-tooltip">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="leads">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">Manage Leads</span>
                    <span class="nav-badge" id="leadsCount">0</span>
                    <span class="nav-tooltip">Manage Leads</span>
                </a>
                <a href="#" class="nav-item" data-section="assignment">
                    <i class="fas fa-user-plus"></i>
                    <span class="nav-text">Lead Assignment</span>
                    <span class="nav-tooltip">Lead Assignment</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">Team</div>
                <a href="#" class="nav-item" data-section="team">
                    <i class="fas fa-users-cog"></i>
                    <span class="nav-text">Team Management</span>
                    <span class="nav-tooltip">Team Management</span>
                </a>
                <a href="#" class="nav-item" data-section="call-records">
                    <i class="fas fa-microphone"></i>
                    <span class="nav-text">Call Records</span>
                    <span class="nav-badge" id="callsCount">0</span>
                    <span class="nav-tooltip">Call Records</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">Analytics</div>
                <a href="#" class="nav-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Reports</span>
                    <span class="nav-tooltip">Reports</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <i class="fas fa-analytics"></i>
                    <span class="nav-text">Analytics</span>
                    <span class="nav-tooltip">Analytics</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-title">System</div>
                <a href="/" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span class="nav-text">Back to Home</span>
                    <span class="nav-tooltip">Back to Home</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-text">Logout</span>
                    <span class="nav-tooltip">Logout</span>
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h1 class="page-title" id="pageTitle">Dashboard</h1>
                        <div class="breadcrumb" id="breadcrumb">
                            <span>Manager Panel</span>
                            <span class="breadcrumb-separator">/</span>
                            <span>Dashboard</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-secondary btn-sm" onclick="refreshCurrentSection()">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                    </div>
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar" id="userAvatar">M</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Manager</div>
                            <div class="user-role">Manager</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Dashboard Section -->
                <section class="content-section active" id="dashboard-section">
                    <!-- Stats Grid -->
                    <div class="stats-grid" id="statsGrid">
                        <!-- Stats will be loaded here -->
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Quick Actions</h3>
                        </div>
                        <div class="card-body">
                            <div class="quick-actions">
                                <a href="#" class="quick-action" onclick="showSection('assignment')">
                                    <i class="fas fa-user-plus"></i>
                                    <div class="quick-action-title">Assign Leads</div>
                                    <div class="quick-action-desc">Assign leads to team members</div>
                                </a>
                                <a href="#" class="quick-action" onclick="autoDistributeLeads()">
                                    <i class="fas fa-random"></i>
                                    <div class="quick-action-title">Auto Distribute</div>
                                    <div class="quick-action-desc">Automatically distribute leads</div>
                                </a>
                                <a href="#" class="quick-action" onclick="showSection('call-records')">
                                    <i class="fas fa-microphone"></i>
                                    <div class="quick-action-title">Call Records</div>
                                    <div class="quick-action-desc">View team call records</div>
                                </a>
                                <a href="#" class="quick-action" onclick="showSection('reports')">
                                    <i class="fas fa-chart-bar"></i>
                                    <div class="quick-action-title">Generate Report</div>
                                    <div class="quick-action-desc">Create performance reports</div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Activity</h3>
                            <button class="btn btn-secondary btn-sm" onclick="loadRecentActivity()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="recentActivity">
                                <!-- Recent activity will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Leads Section -->
                <section class="content-section" id="leads-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Manage Leads</h3>
                            <div class="card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="exportLeads()">
                                    <i class="fas fa-download"></i>
                                    Export
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="loadLeads()">
                                    <i class="fas fa-sync-alt"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Filters -->
                            <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                                <select id="statusFilter" onchange="filterLeads()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="">All Statuses</option>
                                    <option value="New">New</option>
                                    <option value="Interested">Interested</option>
                                    <option value="Hot">Hot</option>
                                    <option value="Follow-up">Follow-up</option>
                                    <option value="Won">Won</option>
                                    <option value="Lost">Lost</option>
                                </select>
                                <select id="employeeFilter" onchange="filterLeads()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="">All Employees</option>
                                </select>
                                <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                                    <i class="fas fa-times"></i>
                                    Clear
                                </button>
                            </div>

                            <div id="leadsContainer">
                                <!-- Leads will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Assignment Section -->
                <section class="content-section" id="assignment-section">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                        <!-- Available Leads -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Available Leads</h3>
                                <button class="btn btn-secondary btn-sm" onclick="selectAllLeads()">
                                    <i class="fas fa-check-square"></i>
                                    Select All
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="availableLeads">
                                    <!-- Available leads will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Assignment Panel -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Assignment Options</h3>
                            </div>
                            <div class="card-body">
                                <!-- Manual Assignment -->
                                <div style="margin-bottom: 24px; padding: 16px; background: var(--fr-bg); border-radius: 8px;">
                                    <h4 style="margin-bottom: 12px;">Manual Assignment</h4>
                                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                        <select id="assignToEmployee" style="flex: 1; padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                            <option value="">Select Employee</option>
                                        </select>
                                        <button class="btn btn-primary" onclick="assignSelectedLeads()">
                                            <i class="fas fa-user-plus"></i>
                                            Assign
                                        </button>
                                    </div>
                                </div>

                                <!-- Auto Distribution -->
                                <div style="margin-bottom: 24px; padding: 16px; background: var(--fr-bg); border-radius: 8px;">
                                    <h4 style="margin-bottom: 12px;">Auto Distribution</h4>
                                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                                        <input type="number" id="leadsPerEmployee" placeholder="Leads per employee" min="1" style="flex: 1; padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                        <button class="btn btn-success" onclick="autoDistributeSelected()">
                                            <i class="fas fa-random"></i>
                                            Distribute
                                        </button>
                                    </div>
                                    <p style="font-size: 12px; color: var(--fr-muted); margin: 0;">
                                        Leave empty for round-robin distribution
                                    </p>
                                </div>

                                <!-- Team Overview -->
                                <div style="padding: 16px; background: var(--fr-bg); border-radius: 8px;">
                                    <h4 style="margin-bottom: 12px;">Team Overview</h4>
                                    <div id="teamOverview">
                                        <!-- Team overview will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Team Section -->
                <section class="content-section" id="team-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Team Management</h3>
                            <button class="btn btn-primary btn-sm" onclick="loadTeamData()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="teamContainer">
                                <!-- Team data will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Call Records Section -->
                <section class="content-section" id="call-records-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Call Records</h3>
                            <div class="card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="exportCallRecords()">
                                    <i class="fas fa-download"></i>
                                    Export
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="loadCallRecords()">
                                    <i class="fas fa-sync-alt"></i>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Filters -->
                            <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                                <select id="callEmployeeFilter" onchange="filterCallRecords()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="">All Employees</option>
                                </select>
                                <select id="callStatusFilter" onchange="filterCallRecords()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="">All Statuses</option>
                                    <option value="completed">Completed</option>
                                    <option value="missed">Missed</option>
                                    <option value="declined">Declined</option>
                                </select>
                                <input type="date" id="callDateFrom" onchange="filterCallRecords()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                <input type="date" id="callDateTo" onchange="filterCallRecords()" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                            </div>

                            <div id="callRecordsContainer">
                                <!-- Call records will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section class="content-section" id="reports-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reports & Analytics</h3>
                            <div class="card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="exportReport()">
                                    <i class="fas fa-download"></i>
                                    Export
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="generateReport()">
                                    <i class="fas fa-chart-bar"></i>
                                    Generate
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Report Filters -->
                            <div style="display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap;">
                                <select id="reportType" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="performance">Performance Report</option>
                                    <option value="leads">Leads Report</option>
                                    <option value="calls">Call Analytics</option>
                                </select>
                                <input type="date" id="reportDateFrom" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                <input type="date" id="reportDateTo" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                <select id="reportEmployeeFilter" style="padding: 8px 12px; border: 1px solid var(--fr-border); border-radius: 6px;">
                                    <option value="">All Employees</option>
                                </select>
                            </div>

                            <div id="reportContainer">
                                <div class="empty-state">
                                    <i class="fas fa-chart-bar"></i>
                                    <h3>Generate a Report</h3>
                                    <p>Select your filters and click "Generate" to view analytics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section class="content-section" id="analytics-section">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Analytics Dashboard</h3>
                            <button class="btn btn-primary btn-sm" onclick="loadAnalytics()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="analyticsContainer">
                                <!-- Analytics will be loaded here -->
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Audio Player Modal -->
    <div id="audioModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1002; align-items: center; justify-content: center;">
        <div style="background: var(--fr-surface); border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid var(--fr-border);">
                <h3 style="margin: 0;">Call Recording</h3>
                <button onclick="closeAudioModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--fr-muted); padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%;">&times;</button>
            </div>
            <div style="padding: 24px;">
                <div id="audioInfo" style="margin-bottom: 24px; padding: 16px; background: var(--fr-bg); border-radius: 8px; border: 1px solid var(--fr-border);">
                    <!-- Audio info will be loaded here -->
                </div>
                <div style="margin-bottom: 24px;">
                    <audio id="audioPlayer" controls style="width: 100%; margin-bottom: 16px;">
                        Your browser does not support the audio element.
                    </audio>
                </div>
                <div style="padding: 16px; background: var(--fr-bg); border-radius: 8px; border: 1px solid var(--fr-border);">
                    <h4 style="margin: 0 0 12px 0;">Call Notes</h4>
                    <p id="callNotes" style="margin: 0; color: var(--fr-muted); line-height: 1.5;">No notes available for this call.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: var(--fr-surface); padding: 30px; border-radius: 12px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
            <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px; color: var(--fr-primary);"></i>
            <p style="margin: 0; color: var(--fr-text);">Loading...</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        // Global variables
        let currentUser = null;
        let selectedLeads = new Set();
        let allLeads = [];
        let allEmployees = [];
        let callRecords = [];
        let teamMembers = [];
        let currentSection = 'dashboard';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await checkAuth();
                initializeNavigation();
                initializeSidebar();
                await loadInitialData();
                showSection('dashboard');
            } catch (error) {
                console.error('Failed to initialize app:', error);
                showNotification('Failed to initialize application', 'error');
            }
        }

        // Authentication
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login.html';
                return;
            }

            axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
            
            try {
                const response = await axios.get('/api/auth/me');
                currentUser = response.data;
                
                if (currentUser.role !== 'manager') {
                    showNotification('Access denied. Manager role required.', 'error');
                    setTimeout(() => window.location.href = '/', 2000);
                    return;
                }

                updateUserProfile();
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('token');
                window.location.href = '/login.html';
            }
        }

        function updateUserProfile() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            }
        }

        // Sidebar functionality
        function initializeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            // Desktop sidebar toggle
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                const icon = sidebarToggle.querySelector('i');
                icon.className = sidebar.classList.contains('collapsed') ? 'fas fa-chevron-right' : 'fas fa-chevron-left';
            });

            // Mobile menu toggle
            mobileMenuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('mobile-open');
                sidebarOverlay.classList.toggle('active');
            });

            // Close mobile menu when clicking overlay
            sidebarOverlay.addEventListener('click', () => {
                sidebar.classList.remove('mobile-open');
                sidebarOverlay.classList.remove('active');
            });

            // Close mobile menu when clicking nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 1024) {
                        sidebar.classList.remove('mobile-open');
                        sidebarOverlay.classList.remove('active');
                    }
                });
            });
        }

        // Navigation
        function initializeNavigation() {
            const navItems = document.querySelectorAll('.nav-item[data-section]');
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    if (section) {
                        showSection(section);
                    }
                });
            });
        }

        function showSection(sectionId) {
            // Update current section
            currentSection = sectionId;

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show target section
            const targetSection = document.getElementById(`${sectionId}-section`);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNavItem = document.querySelector(`[data-section="${sectionId}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }

            // Update page title and breadcrumb
            updatePageHeader(sectionId);

            // Load section-specific data
            loadSectionData(sectionId);
        }

        function updatePageHeader(sectionId) {
            const titles = {
                'dashboard': 'Dashboard',
                'leads': 'Manage Leads',
                'assignment': 'Lead Assignment',
                'team': 'Team Management',
                'call-records': 'Call Records',
                'reports': 'Reports',
                'analytics': 'Analytics'
            };

            const title = titles[sectionId] || 'Manager Panel';
            document.getElementById('pageTitle').textContent = title;
            
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = `
                <span>Manager Panel</span>
                <span class="breadcrumb-separator">/</span>
                <span>${title}</span>
            `;
        }

        async function loadSectionData(sectionId) {
            try {
                switch(sectionId) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'leads':
                        await loadLeads();
                        break;
                    case 'assignment':
                        await loadAssignmentData();
                        break;
                    case 'team':
                        await loadTeamData();
                        break;
                    case 'call-records':
                        await loadCallRecords();
                        break;
                    case 'reports':
                        // Reports are loaded on demand
                        break;
                    case 'analytics':
                        await loadAnalytics();
                        break;
                }
            } catch (error) {
                console.error(`Failed to load ${sectionId} data:`, error);
                showNotification(`Failed to load ${sectionId} data`, 'error');
            }
        }

        // Load initial data
        async function loadInitialData() {
            showLoading(true);
            try {
                await Promise.all([
                    loadEmployees(),
                    loadDashboardData()
                ]);
            } catch (error) {
                console.error('Failed to load initial data:', error);
                showNotification('Failed to load initial data', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Load employees
        async function loadEmployees() {
            try {
                const response = await axios.get('/api/manager/employees');
                allEmployees = response.data;
                populateEmployeeSelects();
                updateNavBadges();
            } catch (error) {
                console.error('Failed to load employees:', error);
                showNotification('Failed to load team members', 'error');
            }
        }

        function populateEmployeeSelects() {
            const selects = [
                'employeeFilter',
                'assignToEmployee',
                'callEmployeeFilter',
                'reportEmployeeFilter'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Clear existing options (except first one)
                    while (select.children.length > 1) {
                        select.removeChild(select.lastChild);
                    }
                    
                    // Add employee options
                    allEmployees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee._id;
                        option.textContent = employee.name;
                        select.appendChild(option);
                    });
                }
            });
        }

        function updateNavBadges() {
            // Update badges with current counts
            document.getElementById('leadsCount').textContent = allLeads.length;
            document.getElementById('callsCount').textContent = callRecords.length;
        }

        // Dashboard functions
        async function loadDashboardData() {
            try {
                const response = await axios.get('/api/manager/dashboard');
                const data = response.data;
                renderDashboardStats(data);
                await loadRecentActivity();
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
                showNotification('Failed to load dashboard data', 'error');
            }
        }

        function renderDashboardStats(data) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.stats.total}</div>
                    <div class="stat-label">Total Leads</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+12% from last month</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.stats.hot}</div>
                    <div class="stat-label">Hot Leads</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>+5% from last week</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.stats.won}</div>
                    <div class="stat-label">Converted</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>${data.conversionRate}% rate</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon primary">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.totalSales.toLocaleString()}</div>
                    <div class="stat-label">Total Sales</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>This month</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon success">
                            <i class="fas fa-users-cog"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.employees}</div>
                    <div class="stat-label">Team Members</div>
                    <div class="stat-trend">
                        <i class="fas fa-check"></i>
                        <span>Active team</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon warning">
                            <i class="fas fa-percentage"></i>
                        </div>
                    </div>
                    <div class="stat-number">${data.conversionRate}%</div>
                    <div class="stat-label">Conversion Rate</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>Above average</span>
                    </div>
                </div>
            `;
        }

        async function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--fr-bg); border-radius: 8px;">
                        <div style="width: 8px; height: 8px; background: var(--fr-green); border-radius: 50%;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">New lead assigned to John Doe</div>
                            <div style="font-size: 12px; color: var(--fr-muted);">2 minutes ago</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--fr-bg); border-radius: 8px;">
                        <div style="width: 8px; height: 8px; background: var(--fr-primary); border-radius: 50%;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">Call completed by Jane Smith</div>
                            <div style="font-size: 12px; color: var(--fr-muted);">15 minutes ago</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--fr-bg); border-radius: 8px;">
                        <div style="width: 8px; height: 8px; background: var(--fr-orange); border-radius: 50%;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">Lead status updated to Hot</div>
                            <div style="font-size: 12px; color: var(--fr-muted);">1 hour ago</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Leads functions
        async function loadLeads() {
            try {
                showLoading(true);
                const response = await axios.get('/api/manager/leads');
                allLeads = response.data;
                renderLeads(allLeads);
                updateNavBadges();
            } catch (error) {
                console.error('Failed to load leads:', error);
                showNotification('Failed to load leads', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderLeads(leads) {
            const container = document.getElementById('leadsContainer');
            
            if (leads.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No Leads Found</h3>
                        <p>No leads match your current filters</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Lead</th>
                                <th>Contact</th>
                                <th>Status</th>
                                <th>Assigned To</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${leads.map(lead => `
                                <tr>
                                    <td>
                                        <div>
                                            <div style="font-weight: 600;">${lead.name}</div>
                                            ${lead.notes ? `<div style="font-size: 12px; color: var(--fr-muted);">${lead.notes.substring(0, 50)}${lead.notes.length > 50 ? '...' : ''}</div>` : ''}
                                        </div>
                                    </td>
                                    <td>
                                        <div>${lead.phone}</div>
                                        <div style="font-size: 12px; color: var(--fr-muted);">${lead.email || 'No email'}</div>
                                    </td>
                                    <td>
                                        <span class="badge badge-${lead.status.toLowerCase().replace(/\s+/g, '-')}">${lead.status}</span>
                                    </td>
                                    <td>
                                        ${lead.assignedTo ? lead.assignedTo.name : '<span style="color: var(--fr-muted);">Unassigned</span>'}
                                    </td>
                                    <td>
                                        <div>${new Date(lead.createdAt).toLocaleDateString()}</div>
                                        <div style="font-size: 12px; color: var(--fr-muted);">${new Date(lead.createdAt).toLocaleTimeString()}</div>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 4px;">
                                            <button class="btn btn-secondary btn-sm" onclick="editLead('${lead._id}')" title="Edit Lead">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-secondary btn-sm" onclick="viewLeadDetails('${lead._id}')" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function filterLeads() {
            const statusFilter = document.getElementById('statusFilter').value;
            const employeeFilter = document.getElementById('employeeFilter').value;
            
            let filteredLeads = allLeads.filter(lead => {
                if (statusFilter && lead.status !== statusFilter) return false;
                if (employeeFilter && (!lead.assignedTo || lead.assignedTo._id !== employeeFilter)) return false;
                return true;
            });
            
            renderLeads(filteredLeads);
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('employeeFilter').value = '';
            renderLeads(allLeads);
        }

        // Assignment functions
        async function loadAssignmentData() {
            try {
                showLoading(true);
                const [leadsResponse, teamResponse] = await Promise.all([
                    axios.get('/api/manager/leads/for-assignment'),
                    axios.get('/api/manager/team')
                ]);
                
                renderAvailableLeads(leadsResponse.data);
                renderTeamOverview(teamResponse.data);
            } catch (error) {
                console.error('Failed to load assignment data:', error);
                showNotification('Failed to load assignment data', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderAvailableLeads(leads) {
            const container = document.getElementById('availableLeads');
            
            if (leads.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No Available Leads</h3>
                        <p>All leads are currently assigned</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = leads.map(lead => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid var(--fr-border); border-radius: 8px; margin-bottom: 8px;">
                    <input type="checkbox" id="assign-lead-${lead._id}" onchange="toggleAssignmentSelection('${lead._id}')" style="width: 16px; height: 16px;">
                    <div style="flex: 1;">
                        <div style="font-weight: 600;">${lead.name}</div>
                        <div style="font-size: 12px; color: var(--fr-muted);">${lead.phone}  ${lead.status}</div>
                    </div>
                    <span class="badge badge-${lead.status.toLowerCase().replace(/\s+/g, '-')}">${lead.status}</span>
                </div>
            `).join('');
        }

        function renderTeamOverview(team) {
            const container = document.getElementById('teamOverview');
            
            container.innerHTML = team.map(member => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--fr-border);">
                    <span>${member.name}</span>
                    <span style="font-weight: 600; color: var(--fr-primary);">${Math.floor(Math.random() * 20) + 5} leads</span>
                </div>
            `).join('');
        }

        function toggleAssignmentSelection(leadId) {
            const checkbox = document.getElementById(`assign-lead-${leadId}`);
            if (checkbox.checked) {
                selectedLeads.add(leadId);
            } else {
                selectedLeads.delete(leadId);
            }
        }

        function selectAllLeads() {
            const checkboxes = document.querySelectorAll('#availableLeads input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = !allChecked;
                const leadId = checkbox.id.replace('assign-lead-', '');
                if (checkbox.checked) {
                    selectedLeads.add(leadId);
                } else {
                    selectedLeads.delete(leadId);
                }
            });
        }

        async function assignSelectedLeads() {
            const employeeId = document.getElementById('assignToEmployee').value;
            if (!employeeId) {
                showNotification('Please select an employee', 'error');
                return;
            }

            if (selectedLeads.size === 0) {
                showNotification('Please select leads to assign', 'error');
                return;
            }

            try {
                showLoading(true);
                await axios.post('/api/manager/leads/assign', {
                    leadIds: Array.from(selectedLeads),
                    employeeId: employeeId
                });
                
                showNotification('Leads assigned successfully', 'success');
                selectedLeads.clear();
                loadAssignmentData();
            } catch (error) {
                console.error('Failed to assign leads:', error);
                showNotification('Failed to assign leads', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function autoDistributeSelected() {
            const perEmployee = document.getElementById('leadsPerEmployee').value;
            
            try {
                showLoading(true);
                const response = await axios.post('/api/manager/leads/assign/auto', {
                    leadIds: selectedLeads.size > 0 ? Array.from(selectedLeads) : undefined,
                    perEmployee: perEmployee ? parseInt(perEmployee) : undefined
                });
                
                showNotification(`${response.data.assignedCount} leads distributed successfully`, 'success');
                selectedLeads.clear();
                loadAssignmentData();
            } catch (error) {
                console.error('Failed to auto distribute leads:', error);
                showNotification('Failed to auto distribute leads', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Team functions
        async function loadTeamData() {
            try {
                showLoading(true);
                const [teamResponse, performanceResponse] = await Promise.all([
                    axios.get('/api/manager/team'),
                    axios.get('/api/manager/team/performance')
                ]);
                
                teamMembers = teamResponse.data;
                renderTeamData(teamMembers, performanceResponse.data);
            } catch (error) {
                console.error('Failed to load team data:', error);
                showNotification('Failed to load team data', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderTeamData(members, performance) {
            const container = document.getElementById('teamContainer');
            
            if (members.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3>No Team Members</h3>
                        <p>No employees are assigned to your team</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <!-- Performance Overview -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon primary">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-number">${performance.totalTeamMembers}</div>
                        <div class="stat-label">Team Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon success">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="stat-number">${performance.conversionRate}%</div>
                        <div class="stat-label">Team Conversion Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon warning">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-number">${performance.averageResponseTime}</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                </div>

                <!-- Team Members Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Joined</th>
                                <th>Performance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${members.map(member => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--fr-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                                ${member.name.charAt(0)}
                                            </div>
                                            <span style="font-weight: 600;">${member.name}</span>
                                        </div>
                                    </td>
                                    <td>${member.email}</td>
                                    <td><span class="badge badge-new">${member.role}</span></td>
                                    <td>${new Date(member.createdAt).toLocaleDateString()}</td>
                                    <td>
                                        <div style="font-weight: 600; color: var(--fr-primary);">${Math.floor(Math.random() * 30) + 70}%</div>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 4px;">
                                            <button class="btn btn-secondary btn-sm" onclick="viewEmployeeDetails('${member._id}')" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-secondary btn-sm" onclick="viewEmployeePerformance('${member._id}')" title="Performance">
                                                <i class="fas fa-chart-bar"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Call Records functions
        async function loadCallRecords() {
            try {
                showLoading(true);
                const response = await axios.get('/api/manager/call-records');
                callRecords = response.data;
                renderCallRecords(callRecords);
                updateNavBadges();
            } catch (error) {
                console.error('Failed to load call records:', error);
                showNotification('Failed to load call records', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderCallRecords(records) {
            const container = document.getElementById('callRecordsContainer');
            
            if (records.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-microphone"></i>
                        <h3>No Call Records</h3>
                        <p>No call records found for your team</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Lead</th>
                                <th>Contact</th>
                                <th>Status</th>
                                <th>Duration</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${records.map(record => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--fr-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">
                                                ${record.employee?.name?.charAt(0) || 'U'}
                                            </div>
                                            <span>${record.employee?.name || 'Unknown'}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div style="font-weight: 600;">${record.lead?.name || 'Unknown Lead'}</div>
                                    </td>
                                    <td>${record.lead?.phone || 'No phone'}</td>
                                    <td>
                                        <span class="badge badge-${record.callStatus === 'completed' ? 'won' : record.callStatus === 'missed' ? 'lost' : 'new'}">${record.callStatus}</span>
                                    </td>
                                    <td>${formatDuration(record.callDuration)}</td>
                                    <td>
                                        <div>${new Date(record.createdAt).toLocaleDateString()}</div>
                                        <div style="font-size: 12px; color: var(--fr-muted);">${new Date(record.createdAt).toLocaleTimeString()}</div>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 4px;">
                                            ${record.recordingUrl ? 
                                                `<button class="btn btn-primary btn-sm" onclick="playCallRecording('${record._id}')" title="Play Recording">
                                                    <i class="fas fa-play"></i>
                                                </button>` : 
                                                `<button class="btn btn-secondary btn-sm" disabled title="No Recording">
                                                    <i class="fas fa-times"></i>
                                                </button>`
                                            }
                                            <button class="btn btn-secondary btn-sm" onclick="viewCallDetails('${record._id}')" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function filterCallRecords() {
            const employeeFilter = document.getElementById('callEmployeeFilter').value;
            const statusFilter = document.getElementById('callStatusFilter').value;
            const dateFrom = document.getElementById('callDateFrom').value;
            const dateTo = document.getElementById('callDateTo').value;
            
            let filteredRecords = callRecords.filter(record => {
                if (employeeFilter && record.employee._id !== employeeFilter) return false;
                if (statusFilter && record.callStatus !== statusFilter) return false;
                if (dateFrom && new Date(record.createdAt) < new Date(dateFrom)) return false;
                if (dateTo && new Date(record.createdAt) > new Date(dateTo + 'T23:59:59')) return false;
                return true;
            });
            
            renderCallRecords(filteredRecords);
        }

        async function playCallRecording(recordId) {
            try {
                const record = callRecords.find(r => r._id === recordId);
                if (!record || !record.recordingUrl) {
                    showNotification('Recording not available', 'error');
                    return;
                }

                const modal = document.getElementById('audioModal');
                const audioInfo = document.getElementById('audioInfo');
                const audioPlayer = document.getElementById('audioPlayer');
                const callNotes = document.getElementById('callNotes');

                audioInfo.innerHTML = `
                    <div>
                        <div style="font-weight: 600; margin-bottom: 4px;">${record.lead?.name || 'Unknown Lead'}</div>
                        <div style="font-size: 14px; color: var(--fr-muted);">Called by ${record.employee?.name || 'Unknown'} on ${new Date(record.createdAt).toLocaleString()}</div>
                    </div>
                `;

                audioPlayer.src = record.recordingUrl;
                callNotes.textContent = record.notes || 'No notes available for this call.';
                
                modal.style.display = 'flex';
            } catch (error) {
                console.error('Failed to play recording:', error);
                showNotification('Failed to play recording', 'error');
            }
        }

        function closeAudioModal() {
            const modal = document.getElementById('audioModal');
            const audioPlayer = document.getElementById('audioPlayer');
            
            audioPlayer.pause();
            audioPlayer.src = '';
            modal.style.display = 'none';
        }

        // Analytics functions
        async function loadAnalytics() {
            const container = document.getElementById('analyticsContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-chart-line"></i>
                    <h3>Analytics Dashboard</h3>
                    <p>Advanced analytics features coming soon</p>
                </div>
            `;
        }

        // Reports functions
        async function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            const employeeId = document.getElementById('reportEmployeeFilter').value;

            try {
                showLoading(true);
                const params = new URLSearchParams();
                if (dateFrom) params.append('startDate', dateFrom);
                if (dateTo) params.append('endDate', dateTo);
                if (employeeId) params.append('employeeId', employeeId);

                let endpoint = '/api/manager/reports/performance';
                if (reportType === 'leads') {
                    endpoint = '/api/manager/leads/analytics';
                } else if (reportType === 'calls') {
                    endpoint = '/api/manager/call-records/analytics';
                }

                const response = await axios.get(`${endpoint}?${params}`);
                renderReport(response.data, reportType);
            } catch (error) {
                console.error('Failed to generate report:', error);
                showNotification('Failed to generate report', 'error');
            } finally {
                showLoading(false);
            }
        }

        function renderReport(data, reportType) {
            const container = document.getElementById('reportContainer');
            
            if (reportType === 'performance') {
                container.innerHTML = `
                    <div class="stats-grid" style="margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-number">${data.totalLeads}</div>
                            <div class="stat-label">Total Leads</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.totalSales.toLocaleString()}</div>
                            <div class="stat-label">Total Sales</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.conversionRate}%</div>
                            <div class="stat-label">Conversion Rate</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Leads Generated</th>
                                    <th>Leads Converted</th>
                                    <th>Conversion Rate</th>
                                    <th>Revenue Generated</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.teamPerformance.map(perf => `
                                    <tr>
                                        <td>${perf.employeeName}</td>
                                        <td>${perf.leadsGenerated}</td>
                                        <td>${perf.leadsConverted}</td>
                                        <td>${perf.conversionRate}%</td>
                                        <td>${perf.revenueGenerated.toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }

        // Utility functions
        function formatDuration(seconds) {
            if (!seconds) return '0s';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return minutes > 0 ? `${minutes}m ${remainingSeconds}s` : `${remainingSeconds}s`;
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; font-size: 18px; cursor: pointer; color: var(--fr-muted); margin-left: auto;">&times;</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Refresh functions
        function refreshCurrentSection() {
            loadSectionData(currentSection);
        }

        async function autoDistributeLeads() {
            try {
                showLoading(true);
                const response = await axios.post('/api/manager/leads/assign/auto', {});
                showNotification(`${response.data.assignedCount} leads distributed successfully`, 'success');
                refreshCurrentSection();
            } catch (error) {
                console.error('Failed to auto distribute leads:', error);
                showNotification('Failed to auto distribute leads', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Export functions
        async function exportLeads() {
            try {
                const response = await axios.get('/api/manager/export/leads', {
                    responseType: 'blob'
                });
                
                const url = window.URL.createObjectURL(new Blob([response.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', 'leads.csv');
                document.body.appendChild(link);
                link.click();
                link.remove();
                
                showNotification('Leads exported successfully', 'success');
            } catch (error) {
                console.error('Failed to export leads:', error);
                showNotification('Failed to export leads', 'error');
            }
        }

        async function exportCallRecords() {
            showNotification('Call records export feature coming soon', 'info');
        }

        async function exportReport() {
            try {
                const reportType = document.getElementById('reportType').value;
                const dateFrom = document.getElementById('reportDateFrom').value;
                const dateTo = document.getElementById('reportDateTo').value;
                const employeeId = document.getElementById('reportEmployeeFilter').value;

                const params = new URLSearchParams();
                if (dateFrom) params.append('startDate', dateFrom);
                if (dateTo) params.append('endDate', dateTo);
                if (employeeId) params.append('employeeId', employeeId);

                const response = await axios.get(`/api/manager/export/reports?${params}`, {
                    responseType: 'blob'
                });
                
                const url = window.URL.createObjectURL(new Blob([response.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', 'performance_report.csv');
                document.body.appendChild(link);
                link.click();
                link.remove();
                
                showNotification('Report exported successfully', 'success');
            } catch (error) {
                console.error('Failed to export report:', error);
                showNotification('Failed to export report', 'error');
            }
        }

        // Placeholder functions for future implementation
        function editLead(leadId) {
            showNotification('Edit lead feature coming soon', 'info');
        }

        function viewLeadDetails(leadId) {
            showNotification('View lead details feature coming soon', 'info');
        }

        function viewEmployeeDetails(employeeId) {
            showNotification('View employee details feature coming soon', 'info');
        }

        function viewEmployeePerformance(employeeId) {
            showNotification('Employee performance view coming soon', 'info');
        }

        function viewCallDetails(recordId) {
            showNotification('View call details feature coming soon', 'info');
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('audioModal');
            if (event.target === modal) {
                closeAudioModal();
            }
        }
    </script>
</body>
</html>